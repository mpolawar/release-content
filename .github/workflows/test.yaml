name: Get Target Branch Name

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  get_target_branch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Get Target Branch Name
        run: echo "TARGET_BRANCH=${{ github.event.pull_request.base.ref }}" >> $GITHUB_ENV

      - name: Print Target Branch Name
        run: echo "Target branch is $TARGET_BRANCH"

      - name: Print xl-cli and docker version from env 
        run: echo "xl-cli and docker version is ${{ env.VERSION }}"

      - name: Get version name from version.json
        id: load_vars
        run: |
          REF_NAME="${{ github.ref_name }}"
          VAR_FILE="./github/config/version.json"
          if [ -f "$VAR_FILE" ]; then
            VARS=$(jq -r --arg ref "$TARGET_BRANCH" '.[$ref] // .default' "$VAR_FILE")
            echo "$VARS" | jq -r 'to_entries | .[] | "echo \(.key)=\(.value) >> $GITHUB_ENV"' | sh
          else
            echo "VAR=default_value" >> $GITHUB_ENV

      - name: Print version got from json
        run: echo "xl-cli and docker version from josn file is $VAR"
